# RouterSite-OSM

API для отображение карты и расчета расстояний на основе данных от OpenStreetMap, представляет из себя 3 связанных контейнера с OSRM(Open street routing machine), сервис для поиска на карте Photon и Tile Server для запроса карты в удобном для запуска и начальной установки варианте через docker-compose.

## Подготовка рабочего окружения
Для cent-os необходимо установить *epel-release* (чтобы виделся пакет docker-compose), затем установить *git*, *docker* и *docker-compose*<br>
Сделать *git clone* этого репозитария <br>
*Необязательно:* Создать пользователя для упрощения деплоя, например, osm (*adduser osm*), <br>
задать пароль (*passwd osm*) или запретить вход (*passwd -l osm*), создать группу docker (*groupadd docker*), 
добавить пользователя в группу (*usermod -a -G docker osm*), сделать пользователя владельцем склонированного репозитария (*chown osm: routersite-osm*)

## Инструкция по установке и запуску
Скачать данные для карты по адресу http://download.geofabrik.de/ (всю Россию или только центральный федеральный округ), 
переименовать в "*map.osm.pbf*" и положить в папку osm-data<br>
Запустить *docker-compose up --build -d* и проверить подключение на порты 5000,5001 и 5002 (http сервисы) <br>


## Требования к серверу
Если выбрать слишком большой файл данных, или делать первый запуск на слабом сервере - первый запуск может завершиться с ошибкой. <br>
Обычно все упирается в минимальные системные требования для распаковки карты:<br>
* Для первичной установки карты ЦФО требуется около 8Гб <b>свободной</b> оперативной памяти (при недостатке активируйте файл подкачки) и ~20гб места в хранилище <br>
* Для работы достаточно 3Гб оперативной и 30Гб постоянной памяти (увеличение занимаего места из-за генерации png файлов карты при первом обращении к ней)

## Обновление данных
Очистить папку osm-data (под root) и далее следовать инструкции по установке